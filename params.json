{"name":"Philbot","tagline":"Cloudfiles Appliance","body":"[![Build Status](https://travis-ci.org/theodi/philbot.png?branch=master)](https://travis-ci.org/theodi/philbot)\r\n[![Gem Version](https://badge.fury.io/rb/philbot.png)](http://badge.fury.io/rb/philbot)\r\n[![Code Climate](https://codeclimate.com/github/theodi/philbot.png)](https://codeclimate.com/github/theodi/philbot)\r\n[![Coverage Status](https://coveralls.io/repos/theodi/philbot/badge.png)](https://coveralls.io/r/theodi/philbot)\r\n[![Dependency Status](https://gemnasium.com/theodi/philbot.png)](https://gemnasium.com/theodi/philbot)\r\n[![License](http://img.shields.io/license/mit.png?color=green)](http://theodi.mit-license.org/)\r\n[![Things Cleaned](http://img.shields.io/things%20cleaned/all.png?color=green)](http://hyperboleandahalf.blogspot.co.uk/2010/06/this-is-why-ill-never-be-adult.html)\r\n\r\n#Philbot\r\n\r\n_Simple Cloudfiles client_\r\n\r\nLike an [Amazon Storage Gateway](http://aws.amazon.com/storagegateway/), but for Rackspace Cloudfiles. It shows up on your network, you drop your files on it, they find their way to the Cloud.\r\n\r\n##Using it\r\n\r\nThe following will build you a working Philbot appliance on an Ubuntu Precise Vagrant VM. Assumptions:\r\n\r\n* You have a Rackspace Cloudfiles account\r\n* You want to use a Cloudfiles container called _{bucket}_\r\n* You want your local share to reside at _/home/share/_\r\n* You want the device to show up on your network as _{myappliance}_\r\n* You want to login as _{user}_ with password _{password}_\r\n* You're going to mount this with a Mac\r\n* You want to [Samba](http://www.samba.org/) like it's 1999\r\n\r\nCargo-cult at your own risk. So first, there's bunch of spadework to be done (Note: where you see things in {braces}, you actually have fill in stuff, copy 'n' paste will lead to horrible consequences):\r\n\r\n```\r\nsudo bash\r\napt-get update\r\napt-get -y install curl git redis-server samba avahi-daemon\r\nuseradd -s /bin/bash -G admin -m {user}\r\nmkdir -p /home/share\r\nchown nobody:nogroup /home/share\r\n```\r\n\r\nPaste this over _/etc/samba/smb.conf_:\r\n\r\n```\r\n[global]\r\n  workgroup = {myappliance}\r\n  security = user\r\n  kernel oplocks = yes\r\n\r\n[{myappliance}]\r\n  comment = {myappliance}\r\n  path = /home/share\r\n  writeable = yes\r\n  guest ok = no\r\n```\r\n\r\nand do:\r\n\r\n```\r\necho \"{password}\r\n{password}\" | smbpasswd -a -s {user}\r\nsmbpasswd -e {password}\r\n```\r\n\r\nNow paste this into _/etc/avahi/services/smb.service_:\r\n\r\n```\r\n<?xml version=\"1.0\" standalone='no'?>\r\n<!DOCTYPE service-group SYSTEM \"avahi-service.dtd\">\r\n<service-group>\r\n <name replace-wildcards=\"yes\">{myappliance}</name>\r\n <service>\r\n   <type>_smb._tcp</type>\r\n   <port>445</port>\r\n </service>\r\n <service>\r\n   <type>_device-info._tcp</type>\r\n   <port>0</port>\r\n   <txt-record>model=RackMac</txt-record>\r\n </service>\r\n</service-group>\r\n```\r\n\r\nRestart samba and avahi (or just reboot the box) and you should now have a working samba server. It will advertise itself on yer network as _{my appliance}_, and you'll be able to connect as _{user}/{password}_ and drop some files on it.\r\n\r\nPresuming this all works, then go create a Cloudfiles container called _{bucket}_ (using Cyberduck, the Web interface, magic spells, whatever), then configure the actual Philbot code:\r\n\r\n```\r\nsudo su - {user}\r\ncurl -sSL https://get.rvm.io | bash -s stable --ruby\r\nsource ~/.rvm/scripts/rvm\r\ngit clone https://github.com/theodi/philbot\r\ncd philbot/\r\nbundle install\r\n```\r\n\r\nEdit _conf/philbot.yaml_ so it looks like this:\r\n\r\n```\r\nprovider:  Rackspace\r\nusername:  somerackspacelogin\r\napi_key:   longstringoflettersandnumbers11\r\nregion:    lon\r\ncontainer: {bucket}\r\n```\r\n\r\nThen:\r\n\r\n```\r\necho \"SHARE=/home/share/\" > .env\r\nrvmsudo bundle exec foreman export -u {user} -a {user} upstart /etc/init\r\n```\r\n\r\nNow start the service with `service philbot start` (or bounce the box again) and the magic should begin to happen: open a view on your Cloudfiles container (Cyberduck, web browser, remote viewing, whatever you got), then drop some more files in the _{my appliance}_ share and they should start to appear in Cloudfiles. Delete things locally, and they should start to be removed from Cloudfiles.\r\n\r\nYou are now Philbot-compliant.\r\n\r\n##Roadmap\r\n\r\nWe have plans for at least a couple of new features:\r\n\r\n###Auto-configuration\r\n\r\nAll Philbot really does is watch a directory (using the excellent [Listen](https://github.com/guard/listen) gem) for changes, and then queues jobs. So how about something like this:\r\n\r\n* We run a second share, containing (initially) a dummy config file\r\n* We mount the device over the network and edit this dummy file, filling in our actual Rackspace credentials\r\n* Philbot notices this change (because this is what he does) and places the file in the correct location\r\n* Suddenly, everything works\r\n\r\nThere is already code to support this, but it didn't survive first contact with the Real World due to some encoding thing. This is going to get done, though.\r\n\r\n\r\n###Cold storage\r\n\r\nAt present, the Cloudfiles container stays in sync with the local storage. This is fine for now, but eventually even our 2TB USB drive is going to get full up. So here's the plan:\r\n\r\n* When we drop a (empty) file called _freeze_ or something into a local directory, that directory gets deleted locally _but the files remain at the other end_\r\n* We have some kind of index file at the root of the Cloudfiles container containing a list of frozen projects, which we can edit in order to unfreeze things (if this sounds a bit vague, that'll be because we've not really thought this but through yet, but it seems sensible)\r\n\r\n##Raspberry Pi\r\n\r\n[![The Actual Philbot](http://farm4.staticflickr.com/3807/11359480634_0829c3ddc9_z.jpg)](http://www.flickr.com/photos/pikesley/11359480634/lightbox/)\r\nWhen we were designing this, the target was always to put it onto a Raspberry Pi. We have this running right now on a Pi in the [ODI office](http://theodi.org/360s/Office/office.html), connected to a 2TB external USB drive, which gives us a self-contained Cloudfiles appliance for less than a hundred quid!\r\n\r\nThis path, however, is beset by bandits - Raspbian is based on Debian, which means:\r\n\r\n####No Upstart, because ${REASONS}\r\n\r\nI eventually gave up on attempting to get Foreman to do the Right Thing with things-that-are-not-Upstart (life is short, ya know?), put on the bamboo headphones and pasted this at the bottom of _/etc/inittab_:\r\n\r\n```\r\nPH01:4:respawn:/bin/su - philbot -c 'cd /home/philbot/philbot;export PORT=5000;bundle exec ruby bin/philbot /mnt/usb >> /var/log/philbot/philbot-1.log 2>&1'\r\n```\r\n\r\nwhich seems to work.\r\n\r\n####_smbpasswd_ not part of Samba install, also because ${REASONS}\r\n\r\nNot a big deal, but potentially frustrating. This command will fix it\r\n\r\n```\r\nsudo apt-get install samba-common-bin\r\n```\r\n\r\nand now you can add Samba users.\r\n\r\n###RasPi image\r\n\r\nThe eventual plan is to publish a Raspbian-based SD-Card image which will work out a bunch o' stuff, present itself for auto-configuration, and then Just Work.  \r\n\r\n##Issues\r\n\r\nAre [here](https://github.com/theodi/philbot/issues/new). You got ideas, we wanna hear 'em.\r\n\r\n## Contributing\r\n\r\nWe want your pull-requests! Take a fork, clone it and run the test suite (we use [Guard](https://github.com/guard/guard) for Super-Awesome Continuous Testing)\r\n\r\n```\r\nbundle install\r\nbundle exec guard\r\n```\r\n\r\n(Note: this will intermittently fail because testing asynchronous things is hard. Hmm, maybe you can help me fix this, too?)\r\n\r\nThen write some cukes and some code, and send us a PR!\r\n\r\n##License\r\n\r\n[MIT](http://theodi.mit-license.org/)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}